SUPABASE STORAGE CONNECTION & TROUBLESHOOTING GUIDE
===================================================

YOUR COMPLETE CONNECTION DETAILS:
--------------------------------

DATABASE CONNECTION:
postgresql://postgres.yqskldskeokvgigyrfnw:FPZ1FTKg4bXaLxvB@aws-0-ap-southeast-1.pooler.supabase.com:5432/postgres

BREAKDOWN:
- Host: aws-0-ap-southeast-1.pooler.supabase.com
- Port: 5432
- Database: postgres
- Username: postgres.yqskldskeokvgigyrfnw
- Password: FPZ1FTKg4bXaLxvB

API ENDPOINTS:
- Project URL: https://yqskldskeokvgigyrfnw.supabase.co
- Storage API: https://yqskldskeokvgigyrfnw.supabase.co/storage/v1
- Database API: https://yqskldskeokvgigyrfnw.supabase.co/rest/v1

AUTHENTICATION KEYS:
- Anon Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlxc2tsZHNrZW9rdmdpZ3lyZm53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2ODQ0MDMsImV4cCI6MjA2OTI2MDQwM30.5Mly7KA5h8862yEaz0FeiIWfbThcOiEI9QPCk-SX_wo
- Service Role Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlxc2tsZHNrZW9rdmdpZ3lyZm53Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzY4NDQwMywiZXhwIjoyMDY5MjYwNDAzfQ.51ZXyxnjeXUhrrufQrnZOh5-uo67N8Za6Qsz3Bm1TF4

STORAGE BUCKET STRUCTURE:
------------------------
Your admin panel is configured to upload to:
✅ property-images (for all property photos)
✅ property-videos (for property videos)  
✅ property-thumbnails (for generated thumbnails)

Files are organized as: properties/[timestamp]-[random].[ext]
Example: properties/1738123456-abc123.jpg

WHY YOU SEE IMAGES IN BACKEND BUT NOT STORAGE DASHBOARD:
-------------------------------------------------------

1. LOCAL PREVIEW MODE:
   - Admin panel shows file previews using browser FileReader API
   - These are local files, not yet uploaded
   - Visible immediately when you select files

2. UPLOAD TIMING:
   - Images only upload to Storage when you click "Save Property" 
   - Not when you just select/preview them
   - Upload happens during form submission

3. STORAGE DASHBOARD REFRESH:
   - Supabase Storage dashboard may need manual refresh
   - Go to Storage → property-images → Refresh browser
   - Check the 'properties' folder specifically

TESTING THE UPLOAD PROCESS:
--------------------------

STEP 1: Upload Test
1. Open admin: /admin/index.html
2. Click "Add Property"
3. Fill required fields (title, type, status, price, etc.)
4. Upload an image file
5. Click "Save Property" (this triggers upload)
6. Check browser console for upload logs

STEP 2: Verify Storage
1. Go to Supabase Dashboard → Storage
2. Click on "property-images" bucket
3. Look for "properties" folder
4. Files should appear with timestamp names

STEP 3: Check Database
1. Go to Table Editor → properties table
2. Look for your new property
3. Check the main_image field for storage URL

EXPECTED STORAGE URL FORMAT:
https://yqskldskeokvgigyrfnw.supabase.co/storage/v1/object/public/property-images/properties/1738123456-abc123.jpg

TROUBLESHOOTING:
---------------

IF IMAGES STILL NOT IN STORAGE:
1. Check browser console for errors during "Save Property"
2. Verify buckets exist: property-images, property-videos
3. Check bucket policies allow uploads
4. Ensure service role key has storage permissions

BUCKET POLICY EXAMPLE:
```sql
-- Allow uploads to property-images bucket
CREATE POLICY "Allow uploads to property-images" ON storage.objects 
FOR INSERT TO authenticated, anon 
WITH CHECK (bucket_id = 'property-images');
```

CONNECTION TEST COMMAND:
If you want to test database connection directly:
```bash
psql "postgresql://postgres.yqskldskeokvgigyrfnw:FPZ1FTKg4bXaLxvB@aws-0-ap-southeast-1.pooler.supabase.com:5432/postgres"
```

STORAGE VS DATABASE SEPARATION:
------------------------------
✅ TEXT DATA → Database tables (properties, property_images, etc.)
✅ MEDIA FILES → Storage buckets (property-images, property-videos)
✅ DATABASE LINKS → URLs pointing to storage files

This is the correct architecture. Your "session puller" for storage is separate from database operations, which is ideal for performance and organization.

STATUS: Upload functionality is active. If you see images in admin preview, they should upload to Storage when you save the property.